<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Paytalk STK Checkout</title>
    <style>
      :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --accent2:#06b6d4; }
      *{box-sizing:border-box}
      body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(135deg,#0b1220,#0f172a 60%);color:var(--text);min-height:100vh;display:grid;place-items:center;padding:24px}
      .card{width:100%;max-width:560px;background:rgba(17,24,39,0.7);backdrop-filter:blur(6px);border:1px solid rgba(148,163,184,0.15);border-radius:16px;padding:28px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
      h1{margin:0 0 8px;font-size:26px}
      p.sub{margin:0 0 20px;color:var(--muted)}
      form{display:grid;gap:16px;margin-top:8px}
      label{font-size:14px;color:#cbd5e1}
      input{width:100%;padding:14px 14px;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:rgba(15,23,42,.6);color:var(--text);outline:none}
      input:focus{border-color:var(--accent2);box-shadow:0 0 0 4px rgba(6,182,212,.15)}
      button{padding:14px 16px;border-radius:12px;border:0;background:linear-gradient(135deg,var(--accent2),var(--accent));color:#052e2b;font-weight:700;cursor:pointer}
      button:disabled{opacity:.6;cursor:not-allowed}
      .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      .status{margin-top:14px;font-size:14px;color:#cbd5e1;min-height:22px}
      .small{font-size:12px;color:#94a3b8}
      .footer{margin-top:16px;color:#94a3b8;font-size:12px}
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Paytalk Lipa na M-Pesa</h1>
      <p class="sub">Enter your phone and amount. You'll receive an STK push on your phone to enter your PIN.</p>
      <form id="payForm">
        <div>
          <label for="phone">Phone Number</label>
          <input id="phone" name="phone" type="tel" placeholder="07XXXXXXXX or 2547XXXXXXXX" required />
        </div>
        <div class="row">
          <div>
            <label for="amount">Amount</label>
            <input id="amount" name="amount" type="number" min="1" step="1" placeholder="100" required />
          </div>
          <div>
            <label for="name">Name (optional)</label>
            <input id="name" name="name" type="text" placeholder="Customer Name" />
          </div>
        </div>
        <button id="payBtn" type="submit">Pay Now</button>
        <div class="status" id="status"></div>
        <div class="small">Tip: Ensure the phone is on and SIM has M-Pesa enabled.</div>
      </form>
      <div class="footer">© Checkout Demo</div>
    </div>

    <script>
      const form = document.getElementById('payForm');
      const btn = document.getElementById('payBtn');
      const statusEl = document.getElementById('status');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        statusEl.textContent = '';
        btn.disabled = true;
        btn.textContent = 'Initiating…';
        try {
          const payload = {
            phone: document.getElementById('phone').value.trim(),
            amount: document.getElementById('amount').value.trim()
          };
          const res = await fetch('/api/pay', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Payment failed');
          statusEl.textContent = `Gateway response: ${data.status}. ${data.gatewayResponse || ''}`;
          if (data.status === 'success') {
            statusEl.textContent += ' Check your phone for the STK prompt.';
          }
        } catch (err) {
          statusEl.textContent = err.message || String(err);
        } finally {
          btn.disabled = false;
          btn.textContent = 'Pay Now';
        }
      });
    </script>
  </body>
</html>
